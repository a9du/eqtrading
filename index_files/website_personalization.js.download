(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){"use strict";function _newArrowCheck(innerThis,boundThis){if(innerThis!==boundThis){throw new TypeError("Cannot instantiate an arrow function")}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable});keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}var helper=require("./utils/helper");var{getWebsitePersonalization:getWebsitePersonalization,getExperience:getExperience}=require("./services");var{RootPathNames:RootPathNames}=require("./utils/constants");var me=document.querySelector("script[nexweave-website-personalized-id]")||document.querySelector("script[data-nexweave-website-personalized-id]");var shortid=me.getAttribute("nexweave-website-personalized-id")||me.getAttribute("data-nexweave-website-personalized-id");window.addEventListener("load",handleElementInjection);function handleElementInjection(){return _handleElementInjection.apply(this,arguments)}function _handleElementInjection(){_handleElementInjection=_asyncToGenerator(function*(){var _this=this;var{timeout:timeout,variables:variables}=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var overrideableVariablesObj=helper.getOveridableVariables();window.removeEventListener("load",handleElementInjection);if(helper.getUrlParams("nexid")||variables||overrideableVariablesObj.overidableVariablesWithDecode&&overrideableVariablesObj.overidableVariablesWithoutDecode&&Object.keys(overrideableVariablesObj.overidableVariablesWithDecode).length>0&&Object.keys(overrideableVariablesObj.overidableVariablesWithoutDecode).length>0){if(variables){overrideableVariablesObj=_objectSpread(_objectSpread({},overrideableVariablesObj),{},{overidableVariablesWithDecode:_objectSpread(_objectSpread({},variables),overrideableVariablesObj.overidableVariablesWithDecode),overidableVariablesWithoutDecode:_objectSpread(_objectSpread({},variables),overrideableVariablesObj.overidableVariablesWithoutDecode)})}if(helper.getUrlParams("nexid")){try{var exp=yield getExperience(helper.getUrlParams("nexid"));if(exp){overrideableVariablesObj=_objectSpread(_objectSpread({},overrideableVariablesObj),{},{overidableVariablesWithDecode:_objectSpread(_objectSpread({},exp.experience.data),overrideableVariablesObj.overidableVariablesWithDecode),overidableVariablesWithoutDecode:_objectSpread(_objectSpread({},exp.experience.data),overrideableVariablesObj.overidableVariablesWithoutDecode)})}}catch(error){}}getWebsitePersonalization(window.location.hostname,shortid).then(function(){var _ref=_asyncToGenerator(function*(res){var _this2=this;_newArrowCheck(this,_this);var editedContentArrary=res.data;if(editedContentArrary&&editedContentArrary.length){var filteredData=editedContentArrary.filter(function(ele){_newArrowCheck(this,_this2);return ele.pathname===window.location.pathname}.bind(this));if(filteredData){for(var i=0;i<filteredData.length;i++){try{var element=filteredData[i];if(element.pathname===window.location.pathname||helper.checkRootPage(window.location.pathname,element.pathname)){var editedHtml=document.querySelector(element.selector);var editedHtmlElement=document.body.contains(editedHtml);if(editedHtml&&editedHtmlElement){helper.renderElement(element,editedHtml,overrideableVariablesObj)}}}catch(error){console.log(error)}}}}});return function(_x){return _ref.apply(this,arguments)}}().bind(this))}return false});return _handleElementInjection.apply(this,arguments)}window.nexweave={init:handleElementInjection};window.nexPersonalization={refreshPersonalization:handleElementInjection}},{"./services":2,"./utils/constants":3,"./utils/helper":4}],2:[function(require,module,exports){"use strict";function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}var{BASE_SERVICE_URL:BASE_SERVICE_URL}=require("../utils/constants");exports.getWebsitePersonalization=function(){var _ref=_asyncToGenerator(function*(domain,id){var qs="domain=".concat(encodeURIComponent(domain));var response=yield fetch("".concat(BASE_SERVICE_URL,"/api/v1/website-personalization/").concat(id,"/get-data?").concat(qs),{method:"GET"});return response.json()});return function(_x,_x2){return _ref.apply(this,arguments)}}();exports.getExperience=function(){var _ref2=_asyncToGenerator(function*(id){var response=yield fetch("".concat(BASE_SERVICE_URL,"/api/v1/experience/").concat(id),{method:"GET"});return response.json()});return function(_x3){return _ref2.apply(this,arguments)}}()},{"../utils/constants":3}],3:[function(require,module,exports){"use strict";module.exports.BASE_SERVICE_URL="https://api.nexweave.com";module.exports.TextNodeNames=["DIV","P","H1","H2","H3","H4","H5","H6","LABEL","BUTTON","A","SPAN","STRONG","INPUT","LI"];module.exports.ImageNodeNames=["IMG","PICTURE"];module.exports.VideoNodeNames=["DIV"];module.exports.NEX_EXPERIENCE_TYPE={TEXT:"TEXT",VIDEO:"VIDEO",IMAGE:"IMAGE"};module.exports.RootPathNames=["/index.html","/index.php","/"];module.exports.NEX_IFRAME_WRAPPER_CLASSNAME="nex_iframe_wrapper"},{}],4:[function(require,module,exports){"use strict";var _this3=void 0;function _newArrowCheck(innerThis,boundThis){if(innerThis!==boundThis){throw new TypeError("Cannot instantiate an arrow function")}}var{NEX_IFRAME_WRAPPER_CLASSNAME:NEX_IFRAME_WRAPPER_CLASSNAME}=require("../utils/constants");var{TextNodeNames:TextNodeNames,ImageNodeNames:ImageNodeNames,NEX_EXPERIENCE_TYPE:NEX_EXPERIENCE_TYPE,RootPathNames:RootPathNames}=require("./constants");exports.getOveridableVariables=function(){var _this=this;var queryString=window.location.search;var urlParamsDecoded=this.parseQueryString(queryString).decoded||{};var urlParamsEncoded=this.parseQueryString(queryString).encoded||{};var overidableVariablesWithDecode={};Object.keys(urlParamsDecoded).forEach(function(key){_newArrowCheck(this,_this);if(key.substring(0,4)==="VAR_"){var newKey=key.replace("VAR_","");overidableVariablesWithDecode[newKey]=urlParamsDecoded[key]}}.bind(this));var overidableVariablesWithoutDecode={};Object.keys(urlParamsEncoded).forEach(function(key){_newArrowCheck(this,_this);if(key.substring(0,4)==="VAR_"){var newKey=key.replace("VAR_","");overidableVariablesWithoutDecode[newKey]=urlParamsEncoded[key]}}.bind(this));return{overidableVariablesWithDecode:overidableVariablesWithDecode,overidableVariablesWithoutDecode:overidableVariablesWithoutDecode}};exports.parseQueryString=function(query){var _this2=this;if(!query){return{}}return{decoded:(/^[?#]/.test(query)?query.slice(1):query).split("&").reduce(function(params,param){_newArrowCheck(this,_this2);var item=param.split("=");var key=decodeURIComponent(item[0]||"");var value=decodeURIComponent(item[1]||"");if(key){params[key]=value}return params}.bind(this),{}),encoded:(/^[?#]/.test(query)?query.slice(1):query).split("&").reduce(function(params,param){_newArrowCheck(this,_this2);var item=param.split("=");var key=item[0]||"";var value=item[1]||"";if(key){params[key]=value}return params}.bind(this),{})}};var getInsideDoubleCurly=function getInsideDoubleCurly(str){var _this4=this;_newArrowCheck(this,_this3);return str.split("{{").filter(function(val){_newArrowCheck(this,_this4);return val.includes("}}")}.bind(this)).map(function(val){_newArrowCheck(this,_this4);return val.substring(0,val.indexOf("}}"))}.bind(this))}.bind(void 0);exports.renderText=function(element,overrideableVariablesObj,editedHtml){var replaceInnerHTML=element.newContent;var cnt=replaceInnerHTML.match(/{{([^}]+)}}?/g);if(cnt){var content="";for(var i=0;i<cnt.length;i++){var ele=cnt[i];var variableValue=getInsideDoubleCurly(ele);if(overrideableVariablesObj[variableValue[0]]){if(!content){content=replaceInnerHTML.replace(ele,overrideableVariablesObj[variableValue[0]])}else{content=content.replace(ele,overrideableVariablesObj[variableValue[0]])}editedHtml.innerHTML=content}else{editedHtml.innerHTML=element.oldContent}}}else{editedHtml.innerHTML=replaceInnerHTML}};var getDeviceType=function getDeviceType(){_newArrowCheck(this,_this3);var clientWidth=document.documentElement.clientWidth;if(clientWidth<=420){return"mobile"}return"desktop"}.bind(void 0);var getVideoVariableParams=function getVideoVariableParams(data){_newArrowCheck(this,_this3);var tempVariable="";for(var key of Object.keys(data)){tempVariable+="&".concat(key,"=").concat(data[key])}return tempVariable}.bind(void 0);var getVideoQueryParams=function getVideoQueryParams(variables){_newArrowCheck(this,_this3);var variableParams=getVideoVariableParams(variables);var queryParamsObject={reffer:window.location.hostname,device:getDeviceType()};var tempParams="";for(var key of Object.keys(queryParamsObject)){tempParams+="&".concat(key,"=").concat(queryParamsObject[key])}tempParams+=variableParams;return tempParams}.bind(void 0);var getImageQueryParams=function getImageQueryParams(variables){_newArrowCheck(this,_this3);var variableParams=getVideoVariableParams(variables);var queryParamsObject={};var tempParams="";for(var key of Object.keys(queryParamsObject)){tempParams+="&".concat(key,"=").concat(queryParamsObject[key])}tempParams+=variableParams;return tempParams}.bind(void 0);exports.handleRenderImage=function(element,editedHtml,imageLink){if(element.elementType==="PICTURE"){editedHtml.querySelectorAll("source").forEach(function(node){node.srcset=imageLink});editedHtml.querySelectorAll("source").forEach(function(node){node.srcset=imageLink});editedHtml.querySelectorAll("img").forEach(function(node){var isSrc=node.getAttribute("src");if(isSrc){node.src=imageLink}var isSrcSet=node.getAttribute("srcset");if(isSrcSet){node.srcset=imageLink}})}else if(element.elementType==="IMG"){var isSrc=editedHtml.getAttribute("src");if(isSrc){editedHtml.src=imageLink}var isSrcSet=editedHtml.getAttribute("srcset");if(isSrcSet){editedHtml.srcset=imageLink}}};exports.renderIframe=function(iframeSrc,parentElement,overrideableVariablesObj){var firstChildElement=parentElement.firstChild;if(firstChildElement&&firstChildElement.classList&&firstChildElement.classList.contains(NEX_IFRAME_WRAPPER_CLASSNAME)){firstChildElement.remove()}var div=document.createElement("div");div.innerHTML=iframeSrc.trim();var iframeElement=div.firstChild;if(iframeElement){var experinceUrl=iframeElement.getAttribute("src");var mVideoHeight=iframeElement.getAttribute("mvH");var mVideoWidth=iframeElement.getAttribute("mvW");if(getDeviceType()==="mobile"){iframeElement.setAttribute("vH",mVideoHeight);iframeElement.setAttribute("vW",mVideoWidth)}if(experinceUrl){var updatedUrl="".concat(experinceUrl).concat(getVideoQueryParams(overrideableVariablesObj));iframeElement.setAttribute("src",updatedUrl)}iframeElement.className=NEX_IFRAME_WRAPPER_CLASSNAME;return iframeElement}};exports.checkRootPage=function(currentPagePath,pathname){if(RootPathNames.includes(currentPagePath)&&RootPathNames.includes(pathname)){return true}return false};function handleImageLoad(element,editedHtml,imageLink){handleRenderImage(element,editedHtml,imageLink)}var someEventHander=function someEventHander(element,editedHtml,imageLink){if(element.elementType==="PICTURE"){editedHtml.querySelectorAll("source").forEach(function(node){node.srcset=imageLink});editedHtml.querySelectorAll("source").forEach(function(node){node.srcset=imageLink});editedHtml.querySelectorAll("img").forEach(function(node){var isSrc=node.getAttribute("src");if(isSrc){node.src=imageLink}var isSrcSet=node.getAttribute("srcset");if(isSrcSet){node.srcset=imageLink}})}else if(element.elementType==="IMG"){var isSrc=editedHtml.getAttribute("src");if(isSrc){editedHtml.src=imageLink}var isSrcSet=editedHtml.getAttribute("srcset");if(isSrcSet){editedHtml.srcset=imageLink}}};exports.renderElement=function(element,editedHtml,overrideableVariablesObj){if(element.elementType==="DIV"&&element.type===NEX_EXPERIENCE_TYPE.VIDEO){var iframeDiv=this.renderIframe(element.newContent,editedHtml,overrideableVariablesObj.overidableVariablesWithoutDecode);editedHtml.insertBefore(iframeDiv,editedHtml.firstChild)}else if(element.elementType==="DIV"||element.type===NEX_EXPERIENCE_TYPE.TEXT){this.renderText(element,overrideableVariablesObj.overidableVariablesWithDecode,editedHtml)}else if(TextNodeNames.includes(element.elementType)){this.renderText(element,overrideableVariablesObj.overidableVariablesWithDecode,editedHtml)}else if(ImageNodeNames.includes(element.elementType)){var imageLink="".concat(element.newContent,"?").concat(getImageQueryParams(overrideableVariablesObj.overidableVariablesWithoutDecode));var img=document.querySelector(element.selector);img.addEventListener("load",function handler(){someEventHander(element,editedHtml,imageLink);this.removeEventListener("load",handler)});this.handleRenderImage(element,editedHtml,imageLink)}};exports.reRenderElement=function(editedContentArrary,stringyfyVariables,overrideableVariablesObj){for(var i=0;i<editedContentArrary.length;i++){try{var element=editedContentArrary[i];if(element.pathname===window.location.pathname||this.checkRootPage(window.location.pathname,element.pathname)){var editedHtml=document.querySelector(element.selector);var editedHtmlElement=document.body.contains(editedHtml);if(editedHtml&&editedHtmlElement){this.renderElement(element,editedHtml,overrideableVariablesObj)}}}catch(error){console.log(error)}}};var getDomPath2=function getDomPath2(srcElement){_newArrowCheck(this,_this3);var names=[];var el=srcElement;if(el){while(el&&el.parentNode){if(el.id){names.unshift("#"+el.id);break}else{var _el$ownerDocument;if(el===((_el$ownerDocument=el.ownerDocument)===null||_el$ownerDocument===void 0?void 0:_el$ownerDocument.documentElement)){names.unshift(el.tagName.toLowerCase())}else{for(var c=1,e=el;e.previousElementSibling;e=e.previousElementSibling,c++){}names.unshift(el.tagName.toLowerCase()+":nth-child("+c+")")}el=el.parentNode}}}return names.join(" > ")}.bind(void 0);exports.observeDom=function(editedContentArrary,overrideableVariablesObj){var that=this;var mutationObserver=new MutationObserver(function(mutations){mutations.forEach(function(mutation){var _this5=this;if(editedContentArrary&&editedContentArrary.length){var[foundElement]=editedContentArrary.filter(function(element){_newArrowCheck(this,_this5);return element.selector.includes(getDomPath2(mutation.target))}.bind(this));if(foundElement&&getDomPath2(mutation.target)){if(foundElement.pathname===window.location.pathname||that.checkRootPage(window.location.pathname,foundElement.pathname)){var selElement=document.querySelector("".concat(getDomPath2(mutation.target)));var editedHtmlElement=document.body.contains(selElement);if(selElement&&editedHtmlElement&&selElement.src!==mutation.oldValue||selElement.innerHTML===null){that.renderElement(foundElement,selElement,overrideableVariablesObj);mutationObserver.takeRecords()}}}}})});mutationObserver.observe(document.documentElement,{attributes:true,characterData:true,childList:true,subtree:true,attributeOldValue:true,characterDataOldValue:true})};exports.getUrlParams=function(params){var queryString=window.location.search;var urlParams=new URLSearchParams(queryString);var urlParameter=urlParams.get(params);if(urlParameter){return urlParameter}else{return}}},{"../utils/constants":3,"./constants":3}]},{},[1]);
